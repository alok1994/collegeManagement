<!DOCTYPE html>
<html lang="en">
<head>
  <title>View Fee History</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="/static/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/static/bootstrap.min.css">
  <script src="/static/jquery.min.js"></script>
  <script src="/static/bootstrap.min.js"></script>
</head>
<body>
  {% load custom_filters %}
  <header>
    Welcome {{ user.username }} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <a href="{% url 'logout' %}?next=/loginapp/logout/">Logout</a>
    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}
  </header>
  
  <div class="container-fluid">
    <div class="sidebar">
      <ul class="dashboard_list">
        <li><a href="/dashboard"><i class="fa fa-home" aria-hidden="true"></i> Dashboard</a></li>
        <li><a href="{% url 'admission_form' %}"><i class="fa fa-wpforms" aria-hidden="true"></i> Admission Form</a></li>
        <li><a href="{% url 'student_list' %}"><i class="fa fa-user"></i> Student List</a></li>
        <li><a href="{% url 'first_year' %}"><i class="fa fa-calendar" aria-hidden="true"></i> First Year</a></li>
        <li><a href="{% url 'second_year' %}"><i class="fa fa-calendar" aria-hidden="true"></i> Second Year</a></li>
        <li><a href="{% url 'third_year' %}"><i class="fa fa-calendar" aria-hidden="true"></i> Third Year</a></li>
        <li><a href="{% url 'fee_detail' %}"><i class="fa fa-money" aria-hidden="true"></i> Fee Management</a></li>
        <li><a href="{% url 'student_list_details' %}"><i class="fa fa-certificate" aria-hidden="true"></i>Character Certificate</a></li>
        <li><a href="{% url 'student_list_details_transfer' %}"><i class="fa fa-certificate" aria-hidden="true"></i> Transfer Certificate</a></li>
        <li><a href="{% url 'fee_structure' %}"><i class="fa fa-money" aria-hidden="true"></i> Fee Structure</a></li>
        <li><a href="{% url 'send_messages' %}"><i class="fa fa-bell" aria-hidden="true"></i>Send Notification</a></li>
      </ul>
    </div>
    <div class="content">
      <h2>Fee History {{ student.first_name }} {{ student.middle_name}} {{ student.last_name }}</h2>
      <table class="student_list_tab" border="1">
        <thead>
            <tr>
                <th>Payment Date</th>
                <th>Semester</th>
                <th>Registration Fee</th>
                <th>Tuition Fee</th>
                <th>Exam Fee</th>
                <th>Miscellaneous Fee</th>
                <th>Late Fee </th>
                <th>Discount Fee </th>
                <th>Total Semester Fee</th>
                <th>Total Paid Amount</th>
                <th>Remaining Amount</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for fee in fee_history %}
                <tr>
                    <td>{{ fee.payment_date }}</td>
                    <td>Semester {{ fee.semester }}</td>
                    <td>{{ fee.registration_fee }}</td>
                    <td>{{ fee.tuition_fee }}</td>
                    <td>{{ fee.exam_fee }}</td>
                    <td>{{ fee.miscellaneous_fee }}</td>
                    <td>{{ fee.late_fee }}</td>
                    <td>{{ fee.discount_fee }}</td>
                    <td>{{ fee.total_semester_fee }}</td>
                    <td>{{ fee.total_paid_amount }}</td>
                    <td>{{ fee.remaining_amount }}</td>
                    <td>
                      <button class="send-message-button details_btn" data-student="{{ student.id }}" data-amount="{{ fee.remaining_amount }}">
                          Send Message
                      </button>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
    <script>
      $(document).ready(function () {
    // Attach a click event handler to the "Send Message" button
    $('.send-message-button').click(function () {
        var studentId = $(this).data('student');
        var remainingAmount = $(this).data('amount');
        // Prompt the user to confirm the message
        var confirmation = confirm("Send a message to Student " + studentId + " with a remaining amount of " + remainingAmount + "?");
        if (confirmation) {
            // Use Django's URL reversing to generate the correct URL
            var url = "{% url 'send_message' 0 0 %}".replace("0", studentId).replace("0", remainingAmount);
            window.location.href = url;
        }
    });
});
  </script>
  </div>
</div> 
</body>
</html>
